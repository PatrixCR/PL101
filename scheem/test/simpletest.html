
<!-- saved from url=(0056)http://nathansuniversity.com/scheem/test/simpletest.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>Mocha Tests</title>
  <link rel="stylesheet" href="http://nathansuniversity.com/css/mocha.css">
  <script src="http://nathansuniversity.com/js/jquery-1.7.1.min.js">
  </script>
  <script src="http://nathansuniversity.com/js/chai.js">
  </script>
  <script src="http://nathansuniversity.com/js/mocha.js">
  </script>
  <script src="../parser.js"></script>
  <script src="../scheem.js"></script>
  <script>mocha.setup('tdd')</script>
  <script>
var expect = chai.expect;    
var assert = chai.assert;

// Some unit tests

suite('arithmetic', function() {
    test('add', function() {
        assert.deepEqual(
            evalScheem(['+', 1, ['+', 1, 2]], {}),
            4
        );
    });
    test('substraction', function() {
        assert.deepEqual(
            evalScheem(['-', 10, ['-', 8, 2]], {}),
            4
        );
    });
    test('multiplication', function() {
        assert.deepEqual(
            evalScheem(['*', 1, ['*', 4, 8]], {}),
            32
        );
    });
    test('division', function() {
        assert.deepEqual(
            evalScheem(['/', 40, ['/', 20, 10]], {}),
            20
        );
    });
});

suite('variable assignment', function() {
    test('define', function() {
        var env = {};
        evalScheem(['define', 'x', 5], env)
        assert.deepEqual(
            env, {x: 5}
        );
    });
    test('set!', function() {
        var env = {x: 3};
        evalScheem(['set!', 'x', 5], env)
        assert.deepEqual(
            env, {x: 5}
        );
    });
    test('set! on undefined variable', function() {
        var env = {};
        expect(function () {
            evalScheem(['set!', 'x', 5], env);
        }).to.throw();
    });
});

suite('quote', function() {
    test('a list', function() {
        assert.deepEqual(
            evalScheem(['quote', ['+', 3, 2]], {}),
            ['+', 3, 2]
        );
    });
});

suite('comparison operator', function() {
    test('equal', function() {
        assert.deepEqual(
            evalScheem(['=', 5, ['+', 3, 2]], {}),
            '#t'
        );
    });
    test('less than', function() {
        assert.deepEqual(
            evalScheem(['<', 5, ['*', 3, 2]], {}),
            '#t'
        );
    });
    test('if', function() {
        assert.deepEqual(
            evalScheem(['if', ['=', 'x', 5], 1, 0], {x: 5}),
            1
        );
    });
});

suite('list manipulation', function() {
    test('cons', function() {
        assert.deepEqual(
            evalScheem(['cons', ['quote', [12, 3]], ['quote', [3, 2]]], {}),
            [[12, 3], 3, 2]
        );
    });
    test('car', function() {
        assert.deepEqual(
            evalScheem(['car', ['quote', [1, 3, 2]]], {}),
            1
        );
    });
    test('cdr', function() {
        assert.deepEqual(
            evalScheem(['cdr', ['quote', [1, 3, 2]]], {}),
            [3, 2]
        );
    });
});

suite('expression sequence', function() {
    test('begin', function() {
        assert.deepEqual(
            evalScheem(['begin', ['define', 'x', 5], ['define', 'y', ['*', 'x', 2]], ['if', ['=', 'y', [
              '*', 'x', 2]], 1, 0]], {}),
            1
        );
    });
});

suite('parse', function() {
    test('a number', function() {
        assert.deepEqual(
            SCHEEM.parse('42'),
            42
        );
    });
    test('a variable', function() {
        assert.deepEqual(
            SCHEEM.parse('x'),
            'x'
        );
    });
    test('sequence with quote and comments', function() {
        assert.deepEqual(
            SCHEEM.parse(";;scheem program\n;;testing comments..\n'(+ 1 2 3);;this should be ignored"),
            ["quote", ["+", 1, 2, 3]]
        );
    });
});

suite('interpret', function() {
    test('parse then eval', function() {
        assert.deepEqual(
            evalScheemString("(begin (define x 5) (define y (* x 2)) (if (= y (* x 2)) 1 0))", {}),
            1
        );
    });
});

  </script>
  <script>
    $(function(){
      mocha.run();
    });
  </script>
</head>
<body>
  <div id="mocha"></div>
</body>
</html>
